#VRML_SIM R2025a utf8
# license: Apache License 2.0
# Model of the Intel Realsense D455 RGBD camera.
# template language: javascript

PROTO IntelRealsenseD455 [
  field SFVec3f translation 0.1 0 0.2
  field SFRotation rotation 0 0 1 0
  field SFString name "realsense"
  field SFBool locked FALSE
  field SFString controller "camera_controller"
  field MFString controllerArgs [ ]
  field SFBool supervisor FALSE
  field SFString{"HD", "VGA", "FULL"} resolution "VGA"
  field SFFloat fieldOfView 1.4746
  field SFFloat minRange 0.01
  field SFFloat maxRange 6.0
  field SFNode focus NULL
  field SFNode recognition Recognition { }
  field SFNode physics Physics {
    density -1
    mass 0.35
    centerOfMass [0 0 0]}
]
{
  %<
    const cameraName = fields.name.value;
    const resMode = fields.resolution.value.toUpperCase();
    let width = 1280;
    let height = 800;

    if (resMode === "VGA") {
      width = 640;
      height = 480;
    } else if (resMode === "HD") {
      width = 1280;
      height = 720;
    } else if (resMode === "FULL") {
      width = 1280;
      height = 800;
    }
  >%

  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    locked IS locked
    controller IS controller
    controllerArgs IS controllerArgs
    supervisor IS supervisor

    children [
      RangeFinder {
        translation 0.005 0 0
        name %<='"' + cameraName + '_depth"'>%
        locked TRUE
        fieldOfView IS fieldOfView
        width %<= width >%
        height %<= height >%
        near IS minRange
        minRange IS minRange
        maxRange IS maxRange
        noise 0.01
        resolution 0.001
      }

      Camera {
        translation 0.005 0 0
        name %<='"' + cameraName + '_rgb"'>%
        locked TRUE
        fieldOfView IS fieldOfView
        width %<= width >%
        height %<= height >%
        near IS minRange
        far 10
        exposure 0.5
        antiAliasing TRUE
        noise 0.01
        focus IS focus
        recognition IS recognition
      }

      Solid {
        translation 0.013 0 0
        rotation 0.57735 0.57735 0.57735 2.0944
        children [
          Transform {
            scale 0.001 0.001 0.001
            children [
              Shape {
                geometry Mesh {
                  url "assets/IntelRealsenseD455.stl"
                }
              }
            ]
          }
        ]
        locked TRUE
      }
    ]

    boundingObject Box {
      size 0.000027 0.000123 0.000025
    }

    physics NULL
  }
}
